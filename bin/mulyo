#!/usr/bin/env node

/**
 * â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 * â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
 * â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  
 * â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 * â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
 * 
 * MulyoNode - Runtime yang stabil seperti koalisi gemuk
 * "Tidak ada masalah jika tidak ada yang melaporkan"
 * 
 * Filosofi: Pembangunan harus terus berjalan, kritik harus ditekan.
 */

const { program } = require('commander');
const chalk = require('chalk');
const { t, setLanguage } = require('../lib/i18n');
const handlers = require('../lib/handlers');

// ============================================================================
// CLI SETUP
// ============================================================================

program
  .name('mulyo')
  .description(chalk.yellow(`ğŸ›ï¸  MulyoNode - ${t('tagline')}`))
  .version(handlers.VERSION_REZIM, '-v, --versi', t('version'))
  .option('-l, --lang <code>', 'Set language / Atur bahasa (id, en)', 'id')
  .hook('preAction', (thisCommand, actionCommand) => {
    // Set language before any command runs
    const opts = thisCommand.opts();
    if (opts.lang) {
      setLanguage(opts.lang);
    }
  });

// ============================================================================
// COMMANDS
// ============================================================================

program
  .command('lang [code]')
  .description('Show or set language / Tampilkan atau atur bahasa')
  .action(handlers.handleLang);

program
  .command('init')
  .description(t('cmd.init.desc'))
  .option('-f, --force', 'Force overwrite / Paksa overwrite')
  .action(handlers.handleInit);

program
  .command('start [script]')
  .description('Menjalankan script dengan privilege anak emas')
  .option('-w, --watch', 'Pantau perubahan file (surveillance mode)')
  .option('-d, --delay <ms>', 'Delay blusukan dalam milidetik', '1000')
  .option('-g, --gerilya', 'Jalankan di background (Mode Gerilya/Ordal)')
  .option('--internal-worker', 'Flag rahasia untuk process worker', false)
  .action(handlers.handleStart);

program
  .command('audit')
  .description('Audit kode untuk compliance. Hasil: WTP (dijamin)')
  .option('-d, --detail', 'Tampilkan detail audit (spoiler: tetap WTP)')
  .action(handlers.handleAudit);

program
  .command('bansos')
  .description('Gelontorkan bantuan buffer menjelang deployment')
  .option('-s, --size <size>', 'Ukuran bansos (contoh: 512MB, 1GB)', '1GB')
  .option('-t, --target <target>', 'Target penerima (heap/stack/all)', 'heap')
  .action(handlers.handleBansos);

program
  .command('rapat')
  .description('Simulasi rapat koordinasi (tidak produktif)')
  .option('-d, --durasi <menit>', 'Durasi rapat dalam menit', '60')
  .option('-l, --lokasi <tempat>', 'Lokasi rapat', 'Hotel Bintang 5')
  .action(handlers.handleRapat);

program
  .command('lelang')
  .description('Tender vendor pengadaan dependency (dengan markup)')
  .option('-p, --paket <nama>', 'Nama paket pengadaan', 'dependency-strategis')
  .option('-m, --markup <persen>', 'Markup anggaran dalam persen', '30')
  .action(handlers.handleLelang);

program
  .command('lapor')
  .description('Generate laporan prestasi (selalu positif)')
  .option('-f, --format <type>', 'Format laporan (json/text)', 'text')
  .option('-p, --periode <bulan>', 'Periode laporan', 'Januari 2026')
  .action(handlers.handleLapor);

program
  .command('demo')
  .description('Simulasi penanganan demo/protes')
  .option('-i, --isu <topik>', 'Isu yang diprotes', 'undefined')
  .option('-j, --jumlah <orang>', 'Jumlah pendemo', '100')
  .action(handlers.handleDemo);

program
  .command('reshuffle')
  .description('Rotasi process secara tiba-tiba')
  .option('-a, --alasan <alasan>', 'Alasan reshuffle', 'penyegaran')
  .action(handlers.handleReshuffle);

program
  .command('sensus')
  .description(t('sensus.desc'))
  .action(handlers.handleSensus);

program
  .command('lengser <pid>')
  .description(t('lengser.desc'))
  .action(handlers.handleLengser);

program
  .command('sadap <pid>')
  .description(t('sadap.desc'))
  .action(handlers.handleSadap);

program
  .command('sidak [pid]')
  .description(t('sidak.desc'))
  .action(handlers.handleSidak);

// ============================================================================
// EXECUTE
// ============================================================================

// Tampilkan banner jika tidak ada command
if (process.argv.length <= 2) {
  console.log(chalk.yellow(`
  â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
  â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—
  â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
  â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•    â•šâ•â•â•â•â•â• 
  
  ${chalk.gray('Runtime yang stabil seperti koalisi gemuk')}
  ${chalk.gray('"Tidak ada masalah jika tidak ada yang melaporkan"')}
  
  ${chalk.cyan('Versi')}: ${handlers.VERSION_REZIM}
  ${chalk.cyan('Gunakan')}: mulyo --help untuk melihat perintah
  `));
}

program.parse(process.argv);
